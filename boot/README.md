# boot

## Overview

The boot folder manages files that are used during the bootup process of
the device. Many of the files are added to the boot partition. Most of
the files added are downloaded from the internet as part of the build process.

## Content

The two types of files managed by this folder are:
- configuration files
- firmware files

The former are generally static and checked into the repo. The latter are
downloaded from the internet.

## configuration files

There are two configuration files that can be added to the boot partition to
control how the image behaves:
- `network`
- `wpa_supplicant.conf`

Of these two files, `network` is generated by snippets, while
`wpa_supplicant.conf` is checked in here. The reason for the difference is that
the contents of `network` depends on the type of image being built, while
`wpa_supplicant.conf` is expected to be the same for all targets.

Configuration files can either be modified before the build, or after the
build by mounting the `/boot` partition on your development host. Usually the
`/boot` partition is automounted when an SD card is connected to the
development host.

### network

This file is used to set certain network variables at boot time. If the
`/boot/network` timestamp is newer than its corresponding setting file in the
data partition `/data/var/etc/settings/network`, then supported settings are
copied out of `/boot/network` and into `/data/var/etc/settings/network`.

The file is specified in each target's `boot_files.custom` snippet. You can
modify its contents there on a per-target basis or edit the `/boot/network`
file directly after the image has been built.

The supported variables are:

#### HOSTNAME
Set the device's host name. The value of this can be retrived at runtime
by using getconf. Eg:
```bash
qnxuser@qnxpi:~$ getconf hostname
qnxpi
```

Set it by adding a line like the following to `/boot/network`
```
HOSTNAME=qnxpi
```

If this variable isn't set it defaults to `noname`. However the various builds
will always set this variable based on the target.
| Target | HOSTNAME |
| ------ | -------- |
| RPi4   | qnxpi    |


#### IP_ADDR
Set an explicit IP address to use for the device OR use DHCP to acquire an
address.

The value of this variable is either an IP address in standard dotted notation,
or the string `dhcp`. If the variable is not specified, or is blank it is
treated as if it has the value `dhcp`.

By default, the builds will NOT specify this variable and hence DHCP is used
to acquire an IP address.

Set it by adding a line like the following to `/boot/network`
```bash
IP_ADDR=192.168.0.1
```

#### TIME_SERVERS
A colon separated list of timeservers to use to set the target's clock after
boot.

The value of this variable should be a colon separated list of time servers.
If this variable is not specified then the default value of `pool.ntp.org`
will be used.

By default, the builds will NOT specify this variable and hence `pool.ntp.org`
is used.

Set it by adding a line like the following to `/boot/network`
```bash
TIME_SERVERS=0.pool.ntp.org:1.pool.ntp.org
```

### wpa_supplicant.conf

Ths file is used to override Wi-Fi network details prior to first boot or on
subsequent boots.

See the [Getting Started -> Wi-Fi](https://gitlab.com/qnx/quick-start-images/raspberry-pi-qnx-8.0-quick-start-image/-/wikis/Getting-started#wi-fi)
section of the wiki for the Quickstart Image for more details on how to
populate the file.

Another means of setting the same network configuration can be achieved by
altering a Wi-Fi snippets.  See the [snippets](../snippets#wifi-custom)
README for more details.

For convenience, a verbose version of the file is provided:
`wpa_supplicant.conf.verbose`. This file contains all supported options that
can be set via the `wpa_supplicant.conf` file, along with comments and default
values. It can be used to construct the desired `wpa_supplicant.conf` file
if something beyond a simple configuration is required.

This file is copied to the `/boot` partition but is not used directly.

## firmware files

Various firmware files are often needed for a given target to function properly.
The makefile will automatically download whatever is required for the target
being built. These files are then placed into the folder `build/<target>`.

The build process has support for downloading files from various sources.
See below for the various types that are supported, and how to extend them.

The files, once downloaded are all placed into the `build/<target>` directory.
It is then up to appropriate snippets files to add the files to the target
image at the correct location.

### LOCAL_FILES

These are files that are already local and do not need to be downloaded.
They are copied directly into the build tree at `build/<target>`.

To adjust the list of local files to process modify the `LOCAL_FILES` variable
defined in the makefile. This variable contains the path, relative to the
`boot` folder of the file to copy.

**NOTE** The files are all copied to `build/<target>` with all directory
         information stripped. Thus if you put both `a/some_file` and
         `b/some_file` into `LOCAL_FILES` then only one file:
         `build/<target>/some_file` will exist with no guarantee whether it
         comes from `a` or `b`.

### REMOTE_TARBALLS

These are files that are acquired from a tarball. The entire contents of the
tarball will be placed into `build/<target>`.

The `REMOTE_TARBALLS` variable contains a list of URLS to tarballs. Each URL
is fed to wget to download the tarball locally. It is then extracted into
the `build/<target>` folder.

To adjust the list of tarballs, modify the `REMOTE_TARBALLS` variable.

### REMOTE_LINUX_FW_FILES

These are files downloaded from the Linux Kernel's firmware repo:
https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/

The `REMOTE_LINUX_FW_FILES` variable contains a list of URLs to the file to
download. The file is placed directly into `build/<target>`.

To adjust the list of files to download, modify the `REMOTE_LINUX_FW_FILES`
variable.  For convenience a `LINUX_FW_URL` variable is defined that has
a URL to the firmware repo. Thus to download the file `foo/bar` you would
do something like:
```
REMOTE_LINUX_FW_FILES += $(LINUX_FW_URL)/foo/bar
```

**NOTE** All Linux FW files downloaded come from a single specified release.
         This is controlled by the `LINUX_FW_RELEASE` variable and at the
         time of writing it has the value of `20250509`.

